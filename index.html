<!DOCTYPE html>  <html> <head>   <title>docco.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="resources/docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <ul class="sections">           <li id="title">             <div class="annotation">                 <h1>docco.coffee</h1>             </div>         </li>                              <li id="section-1">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                           <p><strong>Docco</strong> is a quick-and-dirty, few-hundred-line-long, literate-programming-style
documentation generator. It produces HTML
that displays your comments alongside your code. Comments are passed through
<a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a>, and code is
passed through <a href="http://pygments.org/">Pygments</a> syntax highlighting, if it
is present on the system.
This page is the result of running Docco against its own source file.</p>

<p>If you install Docco, you can run it from the command-line:</p>

<pre><code>docco src/*.coffee
</code></pre>

<p>...will generate an HTML documentation page for each of the named source files,
with a menu linking to the other pages, saving it into a <code>docs</code> folder.</p>

<p>The <a href="http://github.com/jashkenas/docco">source for Docco</a> is available on GitHub,
and released under the MIT license.</p>

<p>To install Docco, first make sure you have <a href="http://nodejs.org/">Node.js</a>,
<a href="http://pygments.org/">Pygments</a> (install the latest dev version of Pygments
from <a href="https://bitbucket.org/birkenfeld/pygments-main">its Mercurial repo</a>), and
<a href="http://coffeescript.org/">CoffeeScript</a>. Then, with NPM:</p>

<pre><code>sudo npm install -g docco
</code></pre>

<p>Docco can be used to process CoffeeScript, JavaScript, Ruby, Python, or TeX files.
By default only single-line comments are processed, block comments may be included
by passing the <code>-b</code> flag to Docco.</p>

<h3>Partners in Crime:</h3>

<ul>
<li><p>If <strong>Node.js</strong> doesn't run on your platform, or you'd prefer a more
convenient package, get <a href="http://github.com/rtomayko">Ryan Tomayko</a>'s
<a href="http://rtomayko.github.com/rocco/rocco.html">Rocco</a>, the Ruby port that's
available as a gem.</p></li>
<li><p>If you're writing shell scripts, try
<a href="http://rtomayko.github.com/shocco/">Shocco</a>, a port for the <strong>POSIX shell</strong>,
also by Mr. Tomayko.</p></li>
<li><p>If Python's more your speed, take a look at
<a href="http://github.com/fitzgen">Nick Fitzgerald</a>'s <a href="http://fitzgen.github.com/pycco/">Pycco</a>.</p></li>
<li><p>For <strong>Clojure</strong> fans, <a href="http://blog.fogus.me/">Fogus</a>'s
<a href="http://fogus.me/fun/marginalia/">Marginalia</a> is a bit of a departure from
"quick-and-dirty", but it'll get the job done.</p></li>
<li><p><strong>Lua</strong> enthusiasts can get their fix with
<a href="https://github.com/rgieseke">Robert Gieseke</a>'s <a href="http://rgieseke.github.com/locco/">Locco</a>.</p></li>
<li><p>And if you happen to be a <strong>.NET</strong>
aficionado, check out <a href="https://github.com/dontangg">Don Wilson</a>'s
<a href="http://dontangg.github.com/nocco/">Nocco</a>.</p></li>
</ul>

             </div>                      </li>                              <li id="section-2">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>

<h3>Main Documentation Generation Functions</h3>

             </div>                      </li>                              <li id="section-3">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>

<p>Generate the documentation for a source file by reading it in, splitting it
up into comment/code sections, highlighting them for the appropriate language,
and merging them into an HTML template.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">generateDocumentation = </span><span class="nf">(source, config, callback) -&gt;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="nx">source</span><span class="p">,</span> <span class="nf">(error, buffer) -&gt;</span>
    <span class="k">throw</span> <span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span>
    <span class="nv">code = </span><span class="nx">buffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nv">sections = </span><span class="nx">parse</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">config</span>
    <span class="nx">highlight</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">generateOutput</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">config</span>
      <span class="nx">callback</span><span class="p">()</span></pre></div></div>                      </li>                              <li id="section-4">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>

<p>Given a string of source code, parse out each comment and the code that
follows it, and create an individual <strong>section</strong> for it.
Sections take the form:</p>

<pre><code>{
  docsText: ...
  docsHtml: ...
  codeText: ...
  codeHtml: ...
}
</code></pre>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">parse = </span><span class="nf">(source, code, config) -&gt;</span>
  <span class="nv">param    = </span><span class="s">&#39;&#39;</span>
  <span class="nv">lines    = </span><span class="nx">code</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;\n&#39;</span>
  <span class="nv">sections = </span><span class="p">[]</span>
  <span class="nv">language = </span><span class="nx">getLanguage</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">config</span>
  <span class="nv">hasCode  = docsText = codeText = </span><span class="s">&#39;&#39;</span>
  <span class="nv">in_block = </span><span class="mi">0</span>

  <span class="nv">save = </span><span class="nf">(docsText, codeText) -&gt;</span>
    <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span> <span class="p">{</span><span class="nx">docsText</span><span class="p">,</span> <span class="nx">codeText</span><span class="p">}</span></pre></div></div>                      </li>                              <li id="section-5">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>

<p>Iterate over the source lines, and separate out single/block
comments from code chunks.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">lines</span>
    <span class="k">if</span> <span class="nx">in_block</span>
      <span class="o">++</span><span class="nx">in_block</span></pre></div></div>                      </li>                              <li id="section-6">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>

<p>If we're not in a block comment, and find a match for the start
of one, eat the tokens, and note that we're now in a block.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">in_block</span> <span class="o">and</span> <span class="nx">config</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">and</span> <span class="nx">language</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">and</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentEnter</span><span class="p">)</span>
      <span class="nv">line = </span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentEnter</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
      <span class="nv">in_block = </span><span class="mi">1</span></pre></div></div>                      </li>                              <li id="section-7">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>

<p>Process the line, marking it as docs if we're in a block comment,
or we find a single-line comment marker.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    <span class="nv">single = </span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentMatcher</span> <span class="o">and</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentMatcher</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentFilter</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">in_block</span> <span class="o">or</span> <span class="nx">single</span></pre></div></div>                      </li>                              <li id="section-8">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>

<p>If we have code text, and we're entering a comment, store off
the current docs and code, then start a new section.</p>

             </div>                          <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="nx">hasCode</span>
        <span class="nx">save</span> <span class="nx">docsText</span><span class="p">,</span> <span class="nx">codeText</span>
        <span class="nv">hasCode = docsText = codeText = </span><span class="s">&#39;&#39;</span></pre></div></div>                      </li>                              <li id="section-9">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>

<p>If there's a single comment, and we're not in a block, eat the
comment token.</p>

             </div>                          <div class="content"><div class="highlight"><pre>      <span class="nv">line = </span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentMatcher</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">in_block</span>

      <span class="k">if</span> <span class="nx">in_block</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">language</span><span class="p">.</span><span class="nx">commentNext</span>
        <span class="nv">line = </span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentNext</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="nx">language</span><span class="p">.</span><span class="nx">commentParam</span>
        <span class="nv">param = </span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentParam</span><span class="p">);</span>
        <span class="k">if</span> <span class="nx">param</span>
          <span class="nv">line = </span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;\n&#39;</span> <span class="o">+</span> <span class="s">&#39;&lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nx">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;&lt;/b&gt;&#39;</span><span class="p">);</span></pre></div></div>                      </li>                              <li id="section-10">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>

<p>If we're in a block, and we find the end of it in the line, eat
the end token, and note that we're no longer in the block.</p>

             </div>                          <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="nx">in_block</span> <span class="o">and</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentExit</span><span class="p">)</span>
        <span class="nv">line = </span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">commentExit</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="nv">in_block = </span><span class="kc">false</span>

      <span class="nx">docsText</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s">&#39;\n&#39;</span>
    <span class="k">else</span>
      <span class="nv">hasCode = </span><span class="kc">yes</span>
      <span class="nx">codeText</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s">&#39;\n&#39;</span></pre></div></div>                      </li>                              <li id="section-11">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>

<p>Save the final section, if any, and return the sections array.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nx">save</span> <span class="nx">docsText</span><span class="p">,</span> <span class="nx">codeText</span>   <span class="c1"># if codeText != &#39;&#39; and docsText != &#39;&#39;</span>
  <span class="nx">sections</span></pre></div></div>                      </li>                              <li id="section-12">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>

<p>Highlights parsed sections of code, using <strong>Pygments</strong> over stdio,
and runs the text of their corresponding comments through <strong>Markdown</strong>, using
<a href="https://github.com/coreyti/showdown">Showdown.js</a>.  If Pygments is not present
on the system, output the code in plain text.</p>

<p>We process all sections with single calls to Pygments and Showdown, by
inserting marker comments between them, and then splitting the result
string wherever the marker occurs.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">highlight = </span><span class="nf">(source, sections, config, callback) -&gt;</span>
  <span class="nv">language = </span><span class="nx">getLanguage</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">config</span>
  <span class="nv">pygments = </span><span class="nx">spawn</span> <span class="s">&#39;pygmentize&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s">&#39;-l&#39;</span><span class="p">,</span> <span class="nx">language</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
    <span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;html&#39;</span><span class="p">,</span>
    <span class="s">&#39;-O&#39;</span><span class="p">,</span> <span class="s">&#39;encoding=utf-8,tabsize=2&#39;</span>
  <span class="p">]</span>
  <span class="nv">output = </span><span class="s">&#39;&#39;</span>
  <span class="nv">code = </span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">codeText</span> <span class="k">for</span> <span class="nx">section</span> <span class="k">in</span> <span class="nx">sections</span><span class="p">).</span><span class="nx">join</span> <span class="nx">language</span><span class="p">.</span><span class="nx">codeSplitText</span>
  <span class="nv">docs = </span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docsText</span> <span class="k">for</span> <span class="nx">section</span> <span class="k">in</span> <span class="nx">sections</span><span class="p">).</span><span class="nx">join</span> <span class="nx">language</span><span class="p">.</span><span class="nx">docsSplitText</span>

  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
  <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">result</span> <span class="k">if</span> <span class="nx">result</span>

  <span class="nx">pygments</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;exit&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
    <span class="nv">output = </span><span class="nx">output</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlightStart</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlightEnd</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">output</span> <span class="o">is</span> <span class="s">&#39;&#39;</span>
      <span class="nv">codeFragments = </span><span class="p">(</span><span class="nx">htmlEscape</span> <span class="nx">section</span><span class="p">.</span><span class="nx">codeText</span> <span class="k">for</span> <span class="nx">section</span> <span class="k">in</span> <span class="nx">sections</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">codeFragments = </span><span class="nx">output</span><span class="p">.</span><span class="nx">split</span> <span class="nx">language</span><span class="p">.</span><span class="nx">codeSplitHtml</span>
    <span class="nv">docsFragments = </span><span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">docs</span><span class="p">).</span><span class="nx">split</span> <span class="nx">language</span><span class="p">.</span><span class="nx">docsSplitHtml</span>

    <span class="k">for</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">sections</span>
      <span class="nv">section.codeHtml = </span><span class="nx">highlightStart</span> <span class="o">+</span> <span class="nx">codeFragments</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">highlightEnd</span>
      <span class="nv">section.docsHtml = </span><span class="nx">docsFragments</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="nx">callback</span><span class="p">()</span>

  <span class="k">if</span> <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">writable</span>
    <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span> <span class="nx">code</span>
    <span class="nx">pygments</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span></pre></div></div>                      </li>                              <li id="section-13">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>

<p>Escape an html string, to produce valid non-highlighted output when pygments
is not present on the system.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">htmlEscape = </span><span class="nf">(string) -&gt;</span>
  <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/g</span><span class="p">,</span> <span class="s">&#39;&amp;amp;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/g</span><span class="p">,</span> <span class="s">&#39;&amp;lt;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/g</span><span class="p">,</span> <span class="s">&#39;&amp;gt;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span> <span class="s">&#39;&amp;quot;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&#39;/g</span><span class="p">,</span> <span class="s">&#39;&amp;#x27;&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">,</span><span class="s">&#39;&amp;#x2F;&#39;</span><span class="p">)</span></pre></div></div>                      </li>                              <li id="section-14">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>

<p>Once all of the code is finished highlighting, we can generate the HTML file by
passing the completed sections into the template, and then writing the file to
the specified output path.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">generateOutput = </span><span class="nf">(source, sections, config) -&gt;</span></pre></div></div>                      </li>                              <li id="section-15">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>

<p>Compute the destination HTML path for an input source file path. If the source
is <code>lib/example.coffee</code>, the HTML will be at <code>docs/example.html</code></p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nv">destination = </span><span class="nf">(filepath, ext) -&gt;</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">output</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filepath</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filepath</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;.</span><span class="si">#{</span><span class="nx">ext</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="nv">writeOutput = </span><span class="nf">(source, dest, data) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;docco: </span><span class="si">#{</span><span class="nx">source</span><span class="si">}</span><span class="s"> -&gt; </span><span class="si">#{</span><span class="nx">dest</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">data</span>
  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">markdown</span>
    <span class="nv">dest = </span><span class="nx">destination</span> <span class="nx">source</span><span class="p">,</span> <span class="s">&quot;md&quot;</span>
    <span class="nv">markdown = </span><span class="nx">sections</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nf">(section) -&gt;</span> <span class="nx">section</span><span class="p">.</span><span class="nx">docsText</span> <span class="p">).</span><span class="nx">join</span> <span class="s">&quot;\n&quot;</span>
    <span class="nx">writeOutput</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">markdown</span>
  <span class="nv">title = </span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span> <span class="nx">source</span>
  <span class="nv">dest  = </span><span class="nx">destination</span> <span class="nx">source</span><span class="p">,</span> <span class="s">&#39;html&#39;</span>
  <span class="nv">html  = </span><span class="nx">config</span><span class="p">.</span><span class="nx">doccoTemplate</span> <span class="p">{</span>
    <span class="nv">title      : </span><span class="nx">title</span><span class="p">,</span>
    <span class="nv">sections   : </span><span class="nx">sections</span><span class="p">,</span>
    <span class="nv">sources    : </span><span class="nx">config</span><span class="p">.</span><span class="nx">sources</span><span class="p">,</span>
    <span class="nv">path       : </span><span class="nx">path</span><span class="p">,</span>
    <span class="nv">destination: </span><span class="nx">destination</span>
    <span class="nv">css        : </span><span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">css</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">writeOutput</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">dest</span><span class="p">,</span> <span class="nx">html</span></pre></div></div>                      </li>                              <li id="section-16">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>

<h3>Helpers &amp; Setup</h3>

             </div>                      </li>                              <li id="section-17">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>

<p>Require our external dependencies, including <strong>Showdown.js</strong>
(the JavaScript implementation of Markdown).</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">fs       = </span><span class="nx">require</span> <span class="s">&#39;fs&#39;</span>
<span class="nv">path     = </span><span class="nx">require</span> <span class="s">&#39;path&#39;</span>
<span class="nv">showdown = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;./../vendor/showdown&#39;</span><span class="p">).</span><span class="nx">Showdown</span>
<span class="p">{</span><span class="nx">spawn</span><span class="p">,</span> <span class="nx">exec</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s">&#39;child_process&#39;</span>
<span class="nv">commander = </span><span class="nx">require</span> <span class="s">&#39;commander&#39;</span></pre></div></div>                      </li>                              <li id="section-18">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>

<p>Read resource file and return its content.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">getResource = </span><span class="nf">(name) -&gt;</span>
  <span class="nv">fullPath = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s">&#39;..&#39;</span><span class="p">,</span> <span class="s">&#39;resources&#39;</span><span class="p">,</span> <span class="nx">name</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span></pre></div></div>                      </li>                              <li id="section-19">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>

<p>Languages are stored in JSON format in the file <code>resources/languages.json</code>
Each item maps the file extension to the name of the Pygments lexer and the
symbol that indicates a comment. To add a new language, modify the file.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="nv">languages = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">getResource</span> <span class="s">&#39;languages.json&#39;</span></pre></div></div>                      </li>                              <li id="section-20">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>

<p>Build out the appropriate matchers and delimiters for each language.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="nx">ext</span><span class="p">,</span> <span class="nx">l</span> <span class="k">of</span> <span class="nx">languages</span></pre></div></div>                      </li>                              <li id="section-21">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>

<p>Does the line begin with a comment?</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">symbol</span><span class="p">)</span>
    <span class="nv">l.commentMatcher = </span><span class="sr">///^\s*</span><span class="c1">#{l.symbol}\s?///</span></pre></div></div>                      </li>                              <li id="section-22">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>

<p>Support block comment parsing?</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="sr">if l.enter and l.exit</span>
<span class="sr">    l.blocks = true</span>
<span class="sr">    l.commentEnter = new RegExp(l.enter)</span>
<span class="sr">    l.commentExit = new RegExp(l.exit)</span>
<span class="sr">    if (l.next)</span>
<span class="sr">      l.commentNext = new RegExp(l.next)</span>
<span class="sr">  if l.param</span>
<span class="sr">    l.commentParam = new RegExp(l.param)</span></pre></div></div>                      </li>                              <li id="section-23">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>

<p>Ignore <a href="http://en.wikipedia.org/wiki/Shebang_(Unix)">hashbangs</a>
and interpolations...</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="sr">l.commentFilter = /(^</span><span class="c1">#![/]|^\s*#\{)/</span></pre></div></div>                      </li>                              <li id="section-24">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>

<p>The dividing token we feed into Pygments, to delimit the boundaries between
sections.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="sr">l.codeSplitText = &quot;\n</span><span class="c1">#{l.symbol}DIVIDER\n&quot;</span></pre></div></div>                      </li>                              <li id="section-25">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>

<p>The mirror of <code>codeSplitText</code> that we expect Pygments to return. We can split
on this to recover the original sections.
Note: the class is "c" for Python and "c1" for the other languages</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="sr">l.codeSplitHtml = ///</span><span class="err">\</span><span class="nx">n</span><span class="o">*&lt;</span><span class="nx">span</span><span class="err">\</span><span class="nx">sclass</span><span class="o">=</span><span class="s">&quot;c1?&quot;</span><span class="o">&gt;</span><span class="c1">#{l.symbol}DIVIDER&lt;\/span&gt;\n*///</span></pre></div></div>                      </li>                              <li id="section-26">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>

<p>The dividing token we feed into Showdown, to delimit the boundaries between
sections.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nv">l.docsSplitText = </span><span class="s">&quot;\n</span><span class="err">#</span><span class="si">#{</span><span class="nx">l</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">DOCDIVIDER\n&quot;</span></pre></div></div>                      </li>                              <li id="section-27">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>

<p>The mirror of <code>docsSplitText</code> that we expect Showdown to return. We can split
on this to recover the original sections.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  <span class="nv">l.docsSplitHtml = </span><span class="sr">///&lt;h1&gt;</span><span class="c1">#{l.name}DOCDIVIDER&lt;/h1&gt;///</span></pre></div></div>                      </li>                              <li id="section-28">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>

<p>Get the current language we're documenting, based on the extension.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">getLanguage = (source, config) -&gt;</span>
<span class="sr">  if config?.forceExt?</span>
<span class="sr">    languages[config.forceExt]</span>
<span class="sr">  else</span>
<span class="sr">    languages[path.extname(source)]</span></pre></div></div>                      </li>                              <li id="section-29">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>

<p>Ensure that the destination directory exists.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">ensureDirectory = (dir, cb, made=null) -&gt;</span>
<span class="sr">  mode = parseInt &#39;0777&#39;, 8</span>
<span class="sr">  fs.mkdir dir, mode, (er) -&gt;</span>
<span class="sr">    return cb null, made || dir if not er</span>
<span class="sr">    if er.code == &#39;ENOENT&#39;</span>
<span class="sr">      return ensureDirectory path.dirname(dir), (er, made) -&gt;</span>
<span class="sr">        if er then cb er, made else ensureDirectory dir, cb, made</span>
<span class="sr">    cb er, made</span></pre></div></div>                      </li>                              <li id="section-30">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>

<p>Micro-templating, originally by John Resig, borrowed by way of
<a href="http://documentcloud.github.com/underscore/">Underscore.js</a>.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">template = (str) -&gt;</span>
<span class="sr">  new Function &#39;obj&#39;,</span>
<span class="sr">    &#39;var p=[],print=function(){p.push.apply(p,arguments);};&#39; +</span>
<span class="sr">    &#39;with(obj){p.push(\&#39;&#39; +</span>
<span class="sr">    str.replace(/[\r\t\n]/g, &quot; &quot;)</span>
<span class="sr">       .replace(/&#39;(?=[^&lt;]*%&gt;)/g,&quot;\t&quot;)</span>
<span class="sr">       .split(&quot;&#39;&quot;).join(&quot;\\&#39;&quot;)</span>
<span class="sr">       .split(&quot;\t&quot;).join(&quot;&#39;&quot;)</span>
<span class="sr">       .replace(/&lt;%=(.+?)%&gt;/g, &quot;&#39;,$1,&#39;&quot;)</span>
<span class="sr">       .split(&#39;&lt;%&#39;).join(&quot;&#39;);&quot;)</span>
<span class="sr">       .split(&#39;%&gt;&#39;).join(&quot;p.push(&#39;&quot;) +</span>
<span class="sr">       &quot;&#39;);}return p.join(&#39;&#39;);&quot;</span></pre></div></div>                      </li>                              <li id="section-31">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>

<p>The start of each Pygments highlight block.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">highlightStart = &#39;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&#39;</span></pre></div></div>                      </li>                              <li id="section-32">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>

<p>The end of each Pygments highlight block.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">highlightEnd   = &#39;&lt;/pre&gt;&lt;/div&gt;&#39;</span></pre></div></div>                      </li>                              <li id="section-33">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>

<h3>Public API</h3>

             </div>                      </li>                              <li id="section-34">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>

<p>Docco exports a basic public API for usage in other applications.
A simple usage might look like this</p>

<pre><code>Docco = require('docco')

sources =
  "src/index.coffee"
  "src/plugins/*.coffee"
  "src/web/*.py"

options =
  template : "src/templates/docs/myproject.jst"
  output   : "web/docs"
  css      : "src/templates/docs/myproject.docs.css"
  blocks   : true

Docco.document sources, options, -&gt;
  console.log("Docco documentation complete.")
</code></pre>

             </div>                      </li>                              <li id="section-35">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>

<p>Extract the docco version from <code>package.json</code></p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">version = JSON.parse(fs.readFileSync(&quot;</span><span class="c1">#{__dirname}/../package.json&quot;)).version</span></pre></div></div>                      </li>                              <li id="section-36">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>

<p>Default configuration options.</p>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">defaults =</span>
<span class="sr">  template: &quot;</span><span class="c1">#{__dirname}/../resources/docco.jst&quot;</span>
  <span class="sr">css     : &quot;</span><span class="c1">#{__dirname}/../resources/resources/docco.css&quot;</span>
  <span class="sr">output  : &quot;docs/&quot;</span>
<span class="sr">  forceExt: null,</span>
<span class="sr">  blocks  : false,</span>
<span class="sr">  markdown: false</span></pre></div></div>                      </li>                              <li id="section-37">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>

<h3>Run from Commandline</h3>

             </div>                      </li>                              <li id="section-38">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>

<p>Run Docco from a set of command line arguments.</p>

<ol>
<li>Parse command line using <a href="https://github.com/visionmedia/commander.js">Commander JS</a>.</li>
<li>Document sources, or print the usage help if none are specified.</li>
</ol>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">run = (args=process.argv) -&gt;</span>
<span class="sr">  commander.version(version)</span>
<span class="sr">    .usage(&quot;[options] &lt;filePattern ...&gt;&quot;)</span>
<span class="sr">    .option(&quot;-c, --css [file]&quot;,&quot;use a custom css file&quot;,defaults.css)</span>
<span class="sr">    .option(&quot;-o, --output [path]&quot;,&quot;use a custom output path&quot;,defaults.output)</span>
<span class="sr">    .option(&quot;-t, --template [file]&quot;,&quot;use a custom .jst template&quot;,defaults.template)</span>
<span class="sr">    .option(&quot;-b, --blocks&quot;,&quot;parse block comments where available&quot;,defaults.blocks)</span>
<span class="sr">    .option(&quot;-m, --markdown&quot;,&quot;output markdown&quot;,defaults.markdown)</span>
<span class="sr">    .option(&quot;--force-ext &lt;ext&gt;&quot;,&quot;treat the target files as if they have a specific extension&quot;,defaults.forceExt)</span>
<span class="sr">    .parse(args)</span>
<span class="sr">    .name = &quot;docco&quot;</span>
<span class="sr">  if commander.args.length</span>
<span class="sr">    document(commander.args.slice(),commander)</span>
<span class="sr">  else</span>
<span class="sr">    console.log commander.helpInformation()</span></pre></div></div>                      </li>                              <li id="section-39">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>

<h3>Document Sources</h3>

             </div>                      </li>                              <li id="section-40">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>

<p>Run Docco over a list of <code>sources</code> with the given <code>options</code>.</p>

<ol>
<li>Construct config to use by taking <code>defaults</code> first, then  merging in <code>options</code></li>
<li>Generate the resolved source list, filtering out unknown types.</li>
<li>Load the specified template and css files.</li>
<li>Ensure the output path is created, write out the CSS file,
document each source, and invoke the completion callback if it is specified.</li>
</ol>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">document = (sources, options = {}, callback = null) -&gt;</span>
<span class="sr">  config = {}</span>
<span class="sr">  config[key] = defaults[key] for key,value of defaults</span>
<span class="sr">  config[key] = value for key,value of options if key of defaults</span>

<span class="sr">  resolved = []</span>
<span class="sr">  resolved = resolved.concat(resolveSource(src)) for src in sources</span>
<span class="sr">  config.sources = resolved.filter((source) -&gt; getLanguage source, config).sort()</span>
<span class="sr">  console.log &quot;docco: skipped unknown type (</span><span class="c1">#{m})&quot; for m in resolved when m not in config.sources</span>

  <span class="sr">config.doccoTemplate = template fs.readFileSync(config.template).toString()</span>
<span class="sr">  doccoStyles = fs.readFileSync(config.css).toString()</span>

<span class="sr">  ensureDirectory config.output, -&gt;</span>
<span class="sr">    fs.writeFileSync path.join(config.output,path.basename(config.css)), doccoStyles</span>
<span class="sr">    files = config.sources.slice()</span>
<span class="sr">    nextFile = -&gt;</span>
<span class="sr">      callback() if callback? and not files.length</span>
<span class="sr">      generateDocumentation files.shift(), config, nextFile if files.length</span>
<span class="sr">    nextFile()</span></pre></div></div>                      </li>                              <li id="section-41">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>

<h3>Resolve Wildcard Source Inputs</h3>

             </div>                      </li>                              <li id="section-42">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>

<p>Resolve a wildcard <code>source</code> input to the files it matches.</p>

<ol>
<li>If the input contains no wildcard characters, just return it.</li>
<li>Convert the wildcard match to a regular expression, and return
an array of files in the path that match it.</li>
</ol>

             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">resolveSource = (source) -&gt;</span>
<span class="sr">  return source if not source.match(/([\*\?])/)</span>
<span class="sr">  regex_str = path.basename(source)</span>
<span class="sr">    .replace(/\./g, &quot;\\$&amp;&quot;)</span>
<span class="sr">    .replace(/\*/,&quot;.*&quot;)</span>
<span class="sr">    .replace(/\?/,&quot;.&quot;)</span>
<span class="sr">  regex = new RegExp(&#39;^(&#39; + regex_str + &#39;)$&#39;)</span>
<span class="sr">  file_path = path.dirname(source)</span>
<span class="sr">  files = fs.readdirSync file_path</span>
<span class="sr">  return (path.join(file_path,file) for file in files when file.match regex)</span></pre></div></div>                      </li>                              <li id="section-43">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>

<h3>Exports</h3>

             </div>                      </li>                              <li id="section-44">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>

<p>Information about docco, and functions for programatic usage.</p>             </div>                          <div class="content"><div class="highlight"><pre><span class="sr">exports[key] = value for key, value of {</span>
<span class="sr">  run           : run</span>
<span class="sr">  document      : document</span>
<span class="sr">  parse         : parse</span>
<span class="sr">  resolveSource : resolveSource</span>
<span class="sr">  version       : version</span>
<span class="sr">  defaults      : defaults</span>
<span class="sr">  languages     : languages</span>
<span class="sr">  ensureDirectory: ensureDirectory</span>
<span class="sr">}</span>

</pre></div></div>                      </li>              </ul>    </div> </body> </html> 