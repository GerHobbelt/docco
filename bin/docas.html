<!DOCTYPE html>  <html> <head>   <title>docas</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="generator" content="Docco">   <link rel="stylesheet" media="all" href="/docas/stylesheets/docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="docas.html">                 docas.sh_               </a>                                           <a class="source" href="docci.html">                 docci.js_               </a>                                           <a class="source" href="docco.html">                 docco.js_               </a>                                           <a class="source" href="test.html">                 test.coffee_               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               docas             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Docas</strong> help you document your Git(Hub) repository automatically. It relies on:</p>

<ul>
<li><p><strong><a href="http://jashkenas.github.com/docco">Docco</a></strong>, a quick and dirty, hundred-line-long, literate-programming
style documentation generator invented by <a href="http://jashkenas.github.com">Jeremy Ashkenas</a>.</p></li>
<li><p><strong><a href="http://baoshan.github.com/docas/src/docci.html">Docci</a></strong>, generate an <code>index.html</code> cover page for your git repository.
The cover page contains the repository's recent commit history, a
statistics of languages and slocs, and a file browser for navigation.
Currently not a stand-alone command (only work with docas).</p></li>
</ul>

<p><strong>Docas</strong> can be used as a stand-alone command on the developer's machine,
which will:</p>

<ol>
<li>Clone the GitHub repository into a temporary directory.</li>
<li>Create gh-pages branch (optional) and list dirty directories.</li>
<li>Generate the cover page using docci.</li>
<li>Documente sources for each directory using docco.</li>
<li>Push to the remote gh-pages branch.</li>
</ol>

<p>However, it's recommended to automate such tasks for your every commit using
a service version of docas -- <a href="http://docas.io">docas.io</a>.</p>

<h2>Service Version</h2>

<p>Actually, for most of developers who want a quick and dirty mechanism for
documentation synchronization, please goto <a href="http://docas.io">Docas.io</a>, an
documentation service which synchronize the documents on gh-pages branch in
real time when you make any commit. As simple as adding docas as your
collaborator.</p>

<h2>Command-line usage:</h2>

<pre><code>docas username/repository
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight shebang"><pre><span>#!/usr/bin/env</span> <span>bash

</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Scripting Procedure</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Preparations:</p>

<ol>
<li>Stop execution when encountering any error,</li>
<li>Ensure enough arguments are given,</li>
<li>Parse the arguments into user and repo,</li>
<li>Prepare a temporary working directory (and remove on exit, interruption,
and termination).</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">set</span> -e
<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-lt 1 <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> -e <span class="s2">&quot;\nUsage: docas &lt;username&gt;/&lt;repository&gt;\n&quot;</span>
  <span class="nb">exit</span>
<span class="k">fi</span>
<span class="nv">user</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$1</span> | cut -d<span class="s1">&#39;/&#39;</span> -f1<span class="k">)</span>
<span class="nv">repo</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$1</span> | cut -d<span class="s1">&#39;/&#39;</span> -f2<span class="k">)</span>
<span class="nv">tempdir</span><span class="o">=</span><span class="k">$(</span>mktemp -d /tmp/repo.<span class="nv">$$</span>.XXXXXXXXXX<span class="k">)</span>
<span class="nb">trap</span> <span class="s2">&quot;rm -rf $tempdir; exit&quot;</span> 0 SIGINT SIGTERM</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Phase 1: Clone the Repository</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>(Shallow) clone the GitHub repository to <code>master</code> directory. Keep the current
commit hash of the <code>master</code> branch, which will be included in the commit subject
line of the <code>gh-pages</code> branch to indicate a successful synchronization.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">echo</span> <span class="s2">&quot;Cloning git@github.com:$user/$repo.git...&quot;</span>
git clone -q --depth<span class="o">=</span>1 git@github.com:<span class="nv">$user</span>/<span class="nv">$repo</span>.git <span class="s2">&quot;$tempdir/master&quot;</span>
<span class="nv">commit</span><span class="o">=</span><span class="k">$(</span>git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/master/.git  rev-parse HEAD | cut -c1-10<span class="k">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>Phase 2: Checkout gh-pages Branch, List Dirty Directories</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Docas will only re-generate sources in the <em>dirty</em> directories, in the
following occasions, docas consider all directories are dirty:</p>

<ol>
<li><code>gh-pages</code> does not exist.</li>
<li>No sync found from the <code>gh-pages</code> commits.</li>
<li><code>gh-pages</code> sync found, but could not found according <code>master</code> commit.</li>
</ol>

<p>Situation 2 can be caused by first synchronization, or shallow clone; while
situation 3 can only be caused by shallow clone.</p>             </td>             <td class="code">               <div class="highlight"><pre>all_directories_are_dirty <span class="o">()</span> <span class="o">{</span>
  git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/master/.git ls-tree -r --name-only HEAD <span class="se">\</span>
    | <span class="k">while </span><span class="nb">read </span>file; <span class="k">do </span><span class="nb">echo</span> <span class="k">$(</span>dirname <span class="nv">$file</span><span class="k">)</span>; <span class="k">done</span> <span class="se">\</span>
    | sort | uniq &gt; <span class="nv">$tempdir</span>/dirty_directories
  <span class="k">return</span>
<span class="o">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>If <code>gh-pages</code> branch does not exist, create the <code>gh-pages</code> branch following
<a href="http://help.github.com/pages/#project_pages_manually">GitHub instruction</a>:</p>

<ol>
<li>Duplicate <code>master</code> directory to <code>gh-pages</code> directory.</li>
<li>Change to <code>gh-pages</code> directory.</li>
<li>Create <code>gh-pages</code> branch. </li>
<li>Clear git index.</li>
<li>Remove all files.</li>
</ol>

<p>In this situation, docas considers all directories are dirty.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>git branch -a | grep origin<span class="se">\/</span>gh-pages | wc -l<span class="k">)</span> <span class="o">=</span> 0 <span class="o">]</span>; <span class="k">then</span>

<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Creating gh-pages branch...&quot;</span>
  cp -R <span class="nv">$tempdir</span>/master <span class="nv">$tempdir</span>/gh-pages
  <span class="nb">cd</span> <span class="nv">$tempdir</span>/gh-pages
  git symbolic-ref HEAD refs/heads/gh-pages &gt; /dev/null
  rm .git/index
  git clean -fdx &gt; /dev/null
  all_directories_are_dirty</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If there exists a <code>gh-pages</code> branch, which means the branch <em>may</em> contain docas
synchronized content. So, docas will:</p>

<ol>
<li>Duplicate <code>master</code> directory to <code>gh-pages</code> directory.</li>
<li>Checkout <code>gh-pages</code> branch in <code>gh-pages</code> directory.</li>
<li><p>Analyze dirty directories. Sources in these directories will be
regenerated. Dirty directories are:</p>

<ul><li>Modified directories of the <code>master</code> branch, plus</li>
<li>Modified directories of the <code>gh-pages</code> branch.</li></ul>

<p>All sources in the touched directories will be re-generated since the
<em>JUMP TO</em> links of sibling documents needs be synchronized.</p></li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">else</span>
<span class="k">  </span>cp -R <span class="nv">$tempdir</span>/master <span class="nv">$tempdir</span>/gh-pages
  git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git --work-tree<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages checkout -q gh-pages
  <span class="nv">synced_ghpages_hash</span><span class="o">=</span><span class="k">$(</span>git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git log --pretty<span class="o">=</span>oneline <span class="se">\</span>
    | egrep -m 1 -i <span class="s2">&quot;docas .* [0-9a-f]{10}$&quot;</span> <span class="se">\</span>
    | head -c 10<span class="k">)</span>
  <span class="nv">synced_master_hash</span><span class="o">=</span><span class="k">$(</span>git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git log --pretty<span class="o">=</span>oneline <span class="se">\</span>
    | egrep -m 1 -i <span class="s2">&quot;docas .* [0-9a-f]{10}$&quot;</span> <span class="se">\</span>
    | tail -c 11 <span class="se">\</span>
    | head -c 10<span class="k">)</span>
  <span class="nv">synced_master_hash</span><span class="o">=</span><span class="k">$(</span>git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/master/.git log --pretty<span class="o">=</span>oneline <span class="se">\</span>
    | egrep -m 1 <span class="s2">&quot;^$synced_master_hash&quot;</span> <span class="se">\</span>
    | head -c 10 <span class="se">\</span>
    | xargs <span class="nb">echo</span><span class="k">)</span>

  <span class="nb">echo</span> <span class="s2">&quot;$synced_master_hash | $synced_ghpages_hash&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If we can not securely list all touched files, then docas treat all
as dirty directories.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="o">[</span> -z <span class="nv">$synced_ghpages_hash</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> -z <span class="nv">$synced_master_hash</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;gh-pages branch out-of sync for a long time, rebuilding...&quot;</span>
    all_directories_are_dirty
 </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>If we can securely list all touched files in the <code>master</code> and <code>gh-pages</code>
branch since last sync, output unique directories into dirty_directories file.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Found docas comitted gh-pages, synced with $synced_master_hash&quot;</span>
    git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git diff --name-only <span class="nv">$synced_ghpages_hash</span>..HEAD <span class="se">\</span>
      | <span class="k">while </span><span class="nb">read </span>file; <span class="k">do </span>dirname <span class="nv">$file</span>; <span class="k">done</span> &gt;  <span class="nv">$tempdir</span>/dirty_directories
    git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/master/.git diff --name-only <span class="nv">$synced_master_hash</span>..HEAD <span class="se">\</span>
      | <span class="k">while </span><span class="nb">read </span>file; <span class="k">do </span>dirname <span class="nv">$file</span>; <span class="k">done</span> &gt;&gt; <span class="nv">$tempdir</span>/dirty_directories
    sort -u <span class="nv">$tempdir</span>/dirty_directories -o <span class="nv">$tempdir</span>/dirty_directories
  <span class="k">fi</span>

<span class="k">fi</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>If no file of the <code>master</code> or the <code>gh-pages</code> branch was changed, exit the
program with notification. Nothing needs be done further. Neither the cover
page nor any document needs be re-generated.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>cat <span class="nv">$tempdir</span>/dirty_directories | wc -l<span class="k">)</span> -eq 0 <span class="o">]</span>; <span class="k">then </span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;No file has been touched. Are you kidding?&quot;</span>
  <span class="nb">exit</span>
<span class="k">fi</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Phase 3: Generate Cover Page (using Docci)</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">echo</span> <span class="s2">&quot;Generating cover page...&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Before calling the <strong>docci</strong> command line, following materials should be
ready:</p>

<ol>
<li>a language statistics file named <code>stat</code>, and,</li>
<li>a list of all recognized sources named <code>list</code>.</li>
</ol>

<p>Keep the path name of the master directory into a local variable, which will
be used to remove the prefix from the source list.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">masterdir</span><span class="o">=</span><span class="nv">$tempdir</span>/master
<span class="nv">masterdirlength</span><span class="o">=</span><span class="k">${#</span><span class="nv">masterdir</span><span class="k">}</span>+1
<span class="nb">cd</span> /usr/local/lib/docas/vendor/linguist
bundle <span class="nb">exec </span>linguist <span class="nv">$tempdir</span>/master &gt; <span class="nv">$tempdir</span>/stat
find <span class="nv">$tempdir</span>/master -type f <span class="se">\</span>
  | xargs bundle <span class="nb">exec </span>source_only <span class="se">\</span>
  | <span class="k">while </span><span class="nb">read </span>file; <span class="k">do </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">file</span><span class="p">:</span><span class="nv">$masterdirlength</span><span class="k">}</span>; <span class="k">done</span> &gt; <span class="nv">$tempdir</span>/list</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Make sure a stylesheet for <code>index.html</code> exists. User modification will be
honored. In case of the stylesheet doesn't exists, copy the default stylesheet
to the <code>stylesheet</code> folder.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> ! <span class="o">[</span> -f <span class="nv">$tempdir</span>/gh-pages/stylesheets/index.css <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span>mkdir -p <span class="nv">$tempdir</span>/gh-pages/stylesheets
  cp /usr/local/lib/docas/resources/index.css <span class="nv">$tempdir</span>/gh-pages/stylesheets/index.css
<span class="k">fi</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Invoke the <strong>docci</strong> command-line to generate <code>index.html</code> for <code>master</code>
directory.</p>             </td>             <td class="code">               <div class="highlight"><pre>docci -c <span class="s2">&quot;/$repo/stylesheets/index.css&quot;</span> -o <span class="nv">$tempdir</span>/gh-pages <span class="nv">$tempdir</span>/master</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>Phase 4: Generate Documents (using Docco)</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">echo</span> <span class="s2">&quot;Generating documents...&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h4>1: Prepare Docco Stylesheet</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Make sure a stylesheet for documents exists. User modification will be
honored. In case of the stylesheet doesn't exists, copy the default stylesheet
to the <code>stylesheets</code> folder.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> ! <span class="o">[</span> -f <span class="nv">$tempdir</span>/gh-pages/stylesheets/docco.css <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span>mkdir -p <span class="nv">$tempdir</span>/gh-pages/stylesheets
  cp /usr/local/lib/docas/resources/docco.css <span class="nv">$tempdir</span>/gh-pages/stylesheets/docco.css
<span class="k">fi</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>For each dirty directory, do:</p>             </td>             <td class="code">               <div class="highlight"><pre>cat <span class="nv">$tempdir</span>/dirty_directories | <span class="k">while </span><span class="nb">read </span>dir; <span class="k">do</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h4>2: Clear Touched Directories</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Remove all files generated by <strong>docco</strong> in the touched directories. A
<code>generator</code> meta tag in the docco template is used as a signagure to
identify docco generated documents.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="o">[</span> -d <span class="nv">$tempdir</span>/gh-pages/<span class="nv">$dir</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>find <span class="nv">$tempdir</span>/gh-pages/<span class="nv">$dir</span> -maxdepth 1 -type f -print0 <span class="se">\</span>
      | xargs -0 grep -liZ <span class="s1">&#39;&lt;meta name=&quot;generator&quot; content=&quot;docco.*&quot;&gt;&#39;</span> <span class="se">\</span>
      | xargs -0 rm -f
  <span class="k">fi</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h4>3: Generate Documents</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Process sources for each directory, so the <strong>jump to</strong> section will contain
links to sibling documents only. Following the <a href="http://help.github.com/pages/#project_pages_manually">project page</a> link
structure, generated documents should reference
<code>/&lt;repo&gt;/stylesheets/docco.css</code> in the HTML sources.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="o">[</span> <span class="nv">$dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">]</span>; <span class="k">then </span><span class="nv">match</span><span class="o">=</span><span class="s2">&quot;^[^/]+$&quot;</span>; <span class="k">else </span><span class="nv">match</span><span class="o">=</span><span class="s2">&quot;^$dir/[^/]+$&quot;</span>; <span class="k">fi</span>
<span class="k">  </span>egrep <span class="nv">$match</span> <span class="nv">$tempdir</span>/list | <span class="k">while </span><span class="nb">read </span>file; <span class="k">do</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;$tempdir/master/$file&quot;</span>;
  <span class="k">done</span> | xargs docco -c <span class="s2">&quot;/$repo/stylesheets/docco.css&quot;</span> -o <span class="nv">$tempdir</span>/gh-pages/<span class="nv">$dir</span> <span class="c"># &gt; /dev/null  </span>

<span class="k">done</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>Phase 5: Synchronize with GitHub</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Docas will <em>only</em> touch the gh-pages branch when necessary.</p>

<p>Use the <a href="http://schacon.github.com/git/git.html#_high_level_commands_porcelain">porcelain layer</a> of git-status to count files been created, modified,
or deleted. Output these numbers to the terminal.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">status</span><span class="o">=</span><span class="k">$(</span>git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git --work-tree<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages status --porcelain<span class="k">)</span>

<span class="nb">echo</span> <span class="s2">&quot;Created:$(echo &quot;</span><span class="nv">$status</span><span class="s2">&quot; | egrep &quot;</span>^<span class="o">(</span><span class="se">\?\?</span><span class="o">)</span><span class="s2">&quot; | wc -l)&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Altered:$(echo &quot;</span><span class="nv">$status</span><span class="s2">&quot; | egrep &quot;</span>^<span class="o">(</span>M| M<span class="o">)</span><span class="s2">&quot; | wc -l)&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Deleted:$(echo &quot;</span><span class="nv">$status</span><span class="s2">&quot; | egrep &quot;</span>^<span class="o">(</span>D| D<span class="o">)</span><span class="s2">&quot; | wc -l)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>If there exists any file created, modified, or deleted, then:</p>

<ol>
<li>Synchronize git index with local files,</li>
<li>commit the <code>gh-pages</code> branch, and,</li>
<li>synchronize the <code>gh-pages</code> branch with GitHub remotely.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;$status&quot;</span> | wc -l<span class="k">)</span> -gt 0 <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;Synchronizing GitHub pages remotely...&quot;</span>
  git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git --work-tree<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages add .
  git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git --work-tree<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages commit -qam <span class="s2">&quot;Docas synced with $commit&quot;</span>
  git --git-dir<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages/.git --work-tree<span class="o">=</span><span class="nv">$tempdir</span>/gh-pages push -q origin gh-pages
  <span class="nb">echo</span> <span class="s2">&quot;http://$user.github.com/$repo is now up-to-date. Crowd applauds.&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Nothing to do when no file was created, modified, or deleted. The <code>gh-pages</code>
branch is in-sync with the <code>master</code> branch already.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">else</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;http://$user.github.com/$repo doesn&#39;t need to sync. Code harder.&quot;</span>
<span class="k">fi</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 